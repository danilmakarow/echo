{"ast":null,"code":"import { Subject, takeUntil } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../user-data.service\";\nimport * as i2 from \"../chat-data.service\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = [\"messageRef\"];\nfunction MessageComponent_div_2_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"img\", 11);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MessageComponent_div_2_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵelement(1, \"img\", 13);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MessageComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3, 4)(2, \"div\", 5);\n    i0.ɵɵtemplate(3, MessageComponent_div_2_div_3_Template, 2, 0, \"div\", 6);\n    i0.ɵɵtemplate(4, MessageComponent_div_2_ng_template_4_Template, 2, 0, \"ng-template\", null, 7, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementStart(6, \"p\", 8);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"span\", 9);\n    i0.ɵɵpipe(9, \"date\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"date\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const message_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const _r3 = i0.ɵɵreference(1);\n    const _r5 = i0.ɵɵreference(5);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"lastMes\", ctx_r0.messages.length === i_r2 + 1);\n    i0.ɵɵproperty(\"ngClass\", message_r1.senderId.id === ctx_r0.curUserId ? \"message-centering-right\" : \"message-centering-left\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", _r3.classList.contains(\"message-centering-right\"))(\"ngIfElse\", _r5);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(message_r1.content);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"title\", i0.ɵɵpipeBind2(9, 8, message_r1.time, \"d MMMM, y, HH:mm:ss\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(11, 11, message_r1.time, \"HH:mm\"), \" \");\n  }\n}\nexport class MessageComponent {\n  constructor(userData, chatData) {\n    this.userData = userData;\n    this.chatData = chatData;\n    this.messages = [];\n    this.newChat = true;\n    this.unsubscribe$ = new Subject();\n    this.curUserId = this.userData.curUserDoc?.ref.id;\n  }\n  ngAfterViewInit() {\n    //Scroll - smooth with new message and fast while chat opens\n    this.chatData.chatData$.pipe(takeUntil(this.unsubscribe$)).subscribe(() => this.newChat = true);\n    this.messageItems.changes.pipe(takeUntil(this.unsubscribe$)).subscribe(() => this.scrollToLastItem());\n  }\n  scrollToLastItem() {\n    //TODO Could be done better\n    if (!this.newChat && this.messageItems?.last) this.messageItems.last.nativeElement.scrollIntoView({\n      behavior: 'smooth',\n      block: 'end'\n    });\n    if (this.newChat && this.messageItems?.last) {\n      this.messageItems.last.nativeElement.scrollIntoView({\n        behavior: 'instant',\n        block: 'end'\n      });\n      this.newChat = false;\n    }\n  }\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n}\nMessageComponent.ɵfac = function MessageComponent_Factory(t) {\n  return new (t || MessageComponent)(i0.ɵɵdirectiveInject(i1.UserDataService), i0.ɵɵdirectiveInject(i2.ChatDataService));\n};\nMessageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: MessageComponent,\n  selectors: [[\"app-message\"]],\n  viewQuery: function MessageComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.messageItems = _t);\n    }\n  },\n  inputs: {\n    messages: \"messages\"\n  },\n  decls: 3,\n  vars: 1,\n  consts: [[1, \"main\"], [1, \"messages-container\"], [\"class\", \"message flex\", 3, \"ngClass\", \"lastMes\", 4, \"ngFor\", \"ngForOf\"], [1, \"message\", \"flex\", 3, \"ngClass\"], [\"messageRef\", \"\"], [1, \"message-box\"], [\"class\", \"echo-box right\", 4, \"ngIf\", \"ngIfElse\"], [\"echoLeft\", \"\"], [1, \"message-text\"], [1, \"message-time\", 3, \"title\"], [1, \"echo-box\", \"right\"], [\"src\", \"../../../../../../assets/svg/echo-send.svg\", \"alt\", \"echo-svg\"], [1, \"echo-box\", \"left\"], [\"src\", \"../../../../../../assets/svg/echo-receive.svg\", \"alt\", \"echo-svg\"]],\n  template: function MessageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"main\", 0)(1, \"div\", 1);\n      i0.ɵɵtemplate(2, MessageComponent_div_2_Template, 12, 14, \"div\", 2);\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.messages);\n    }\n  },\n  dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i3.DatePipe],\n  styles: [\".main[_ngcontent-%COMP%]{display:flex;align-items:flex-end;height:100%;width:100%;margin:0 auto;line-height:2.1rem;font-size:1.8rem}.messages-container[_ngcontent-%COMP%]{width:70rem;margin:0 auto;max-height:calc(100% - 6rem)}.message-box[_ngcontent-%COMP%]{position:relative;width:max-content;min-width:7.3rem;max-width:46rem;margin-bottom:1.3rem;padding:.9rem 4.5rem .9rem .9rem;background-color:#5f3dc4}.message-text[_ngcontent-%COMP%]{color:#e8e8e8;font-weight:400}.message-time[_ngcontent-%COMP%]{font-size:1.2rem;position:absolute;right:5px;bottom:0}.message-centering-left[_ngcontent-%COMP%]{justify-content:flex-start}.message-centering-left[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]{border-radius:.85rem 1.3rem .85rem 0;justify-content:flex-start;background-color:#27272a}.message-centering-left[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#686c72}.message-centering-right[_ngcontent-%COMP%]{justify-content:flex-end}.message-centering-right[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]{border-radius:1.3rem .85rem 0;justify-content:flex-end;background-color:#6741d9}.message-centering-right[_ngcontent-%COMP%]   .message-box[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#d0bfff}.echo-box[_ngcontent-%COMP%]{position:absolute}.right[_ngcontent-%COMP%]{left:-19px;top:-11px}.left[_ngcontent-%COMP%]{right:-19px;top:-11px}\"]\n});","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}