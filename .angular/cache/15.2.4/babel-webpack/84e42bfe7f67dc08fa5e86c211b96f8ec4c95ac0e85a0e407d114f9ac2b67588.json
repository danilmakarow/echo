{"ast":null,"code":"import { skip, Subject, takeUntil, tap } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/firestore\";\nimport * as i2 from \"../../../dialog-transfer.service\";\nimport * as i3 from \"./dialogs-data.service\";\nimport * as i4 from \"@angular/material/icon\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/menu\";\nimport * as i7 from \"./dialog/dialog.component\";\nexport class DialogsComponent {\n  ngOnInit() {\n    this.subscribeToDialogs();\n  }\n  // Функция для подписки на изменения списка диалогов\n  subscribeToDialogs() {\n    this.dialogData.dialogs$.pipe(takeUntil(this.unsubscribe$), tap(dialogs => this.dialogs = dialogs), tap(dialogs => this.subscribeToEachDialog(dialogs))).subscribe();\n  }\n  // Функция для подписки на изменения каждого диалога\n  subscribeToEachDialog(dialogs) {\n    dialogs?.forEach(dialog => this.dialogSubscription(dialog));\n  }\n  // Подписываеться на изменения диалога\n  dialogSubscription(dialog) {\n    this.counter = 0;\n    return this.store.doc(`chats/${dialog.ref.id}`).valueChanges().pipe(skip(1), takeUntil(this.unsubscribe$), tap(newDialog => this.createDialogUpdate(dialog, newDialog))).subscribe();\n  }\n  // Функция для создания объекта с обновленными данными диалога\n  createDialogUpdate(dialog, newDialog) {\n    let dialogEl = this.dialogs?.find(dialogEl => dialogEl === dialog);\n    dialogEl = this.changeDialog(dialogEl, newDialog);\n    this.dialogToTop(dialogEl);\n  }\n  // Вырезает диалог с массива диалогов и помещает на верх\n  dialogToTop(dialog) {\n    this.dialogs?.splice(this.dialogs?.findIndex(el => el.ref.id === dialog.ref.id), 1);\n    this.dialogs?.unshift(dialog);\n  }\n  // Берёт последнее сообщение и изменяет диалог\n  changeDialog(oldDialog, updatedDialog) {\n    const lastMessage = updatedDialog.message.slice(-1)[0];\n    this.dialogData.messageLengthFix(lastMessage);\n    oldDialog.lastMessageValue = lastMessage?.content;\n    oldDialog.lastMessageTime = lastMessage?.time;\n    return oldDialog;\n  }\n  constructor(store, dialogTrans, dialogData) {\n    this.store = store;\n    this.dialogTrans = dialogTrans;\n    this.dialogData = dialogData;\n    this.counter = 0;\n    this.unsubscribe$ = new Subject();\n  }\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n}\nDialogsComponent.ɵfac = function DialogsComponent_Factory(t) {\n  return new (t || DialogsComponent)(i0.ɵɵdirectiveInject(i1.AngularFirestore), i0.ɵɵdirectiveInject(i2.DialogTransferService), i0.ɵɵdirectiveInject(i3.DialogsDataService));\n};\nDialogsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DialogsComponent,\n  selectors: [[\"app-dialogs\"]],\n  decls: 33,\n  vars: 2,\n  consts: [[1, \"container\"], [1, \"header\", \"flex\"], [\"mat-icon-button\", \"\", \"color\", \"accent\", 3, \"matMenuTriggerFor\"], [\"menu\", \"matMenu\"], [\"mat-menu-item\", \"\"], [1, \"search-box\"], [\"type\", \"text\", \"placeholder\", \"Search...\", 1, \"search-input\"], [1, \"icon\", \"search-icon\"], [1, \"main\"], [3, \"dialogs\", \"selectedDialog\"]],\n  template: function DialogsComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"header\", 1)(2, \"button\", 2)(3, \"mat-icon\");\n      i0.ɵɵtext(4, \"more_vert\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(5, \"mat-menu\", null, 3)(7, \"button\", 4)(8, \"mat-icon\");\n      i0.ɵɵtext(9, \"person\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"span\");\n      i0.ɵɵtext(11, \"Your Profile\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(12, \"button\", 4)(13, \"mat-icon\");\n      i0.ɵɵtext(14, \"edit\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(15, \"span\");\n      i0.ɵɵtext(16, \"Start new chat\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(17, \"button\", 4)(18, \"mat-icon\");\n      i0.ɵɵtext(19, \"contacts\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(20, \"span\");\n      i0.ɵɵtext(21, \"Contacts\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(22, \"button\", 4)(23, \"mat-icon\");\n      i0.ɵɵtext(24, \"notifications_off\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(25, \"span\");\n      i0.ɵɵtext(26, \"Disable alerts\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(27, \"div\", 5);\n      i0.ɵɵelement(28, \"input\", 6);\n      i0.ɵɵelementStart(29, \"mat-icon\", 7);\n      i0.ɵɵtext(30, \"search\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(31, \"main\", 8)(32, \"app-dialog\", 9);\n      i0.ɵɵlistener(\"selectedDialog\", function DialogsComponent_Template_app_dialog_selectedDialog_32_listener($event) {\n        return ctx.dialogTrans.dialog$.next($event);\n      });\n      i0.ɵɵelementEnd()()();\n    }\n    if (rf & 2) {\n      const _r0 = i0.ɵɵreference(6);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"matMenuTriggerFor\", _r0);\n      i0.ɵɵadvance(30);\n      i0.ɵɵproperty(\"dialogs\", ctx.dialogs);\n    }\n  },\n  dependencies: [i4.MatIcon, i5.MatIconButton, i6.MatMenu, i6.MatMenuItem, i6.MatMenuTrigger, i7.DialogComponent],\n  styles: [\".container[_ngcontent-%COMP%] {\\n  height: 100%;\\n  background-color: #18181b;\\n  border-right: 1px solid #2e2e2e;\\n}\\n\\n\\n.header[_ngcontent-%COMP%] {\\n  align-items: center;\\n  background-color: #1f1f21;\\n  box-shadow: 0 2px 2px rgba(0, 0, 0, 0.25098);\\n}\\n\\n.search-box[_ngcontent-%COMP%] {\\n  width: 100%;\\n  padding: 1.3rem;\\n  position: relative;\\n}\\n\\n.search-input[_ngcontent-%COMP%] {\\n  width: 100%;\\n  border: none;\\n  padding: 1.2rem 1.5rem 1.2rem 4rem;\\n  border-radius: 20px;\\n  font-size: 1.6rem;\\n  color: #fff;\\n  background-color: #27272a;\\n  transition: 0.1s;\\n}\\n\\n.search-input[_ngcontent-%COMP%]:focus {\\n  outline: 2px solid #5f3dc4;\\n}\\n\\n.search-icon[_ngcontent-%COMP%] {\\n  position: absolute;\\n  left: 23px;\\n  top: 22px;\\n}\\n\\n.main[_ngcontent-%COMP%] {\\n  padding: 1rem;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvZmVhdHVyZS9tZXNzZW5nZXIvbWVzc2VuZ2VyL2RpYWxvZ3MvZGlhbG9ncy5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFlBQUE7RUFDQSx5QkFBQTtFQUNBLCtCQUFBO0FBQ0Y7O0FBRUEsU0FBQTtBQUVBO0VBQ0UsbUJBQUE7RUFDQSx5QkFBQTtFQUNBLDRDQUFBO0FBQUY7O0FBR0E7RUFDRSxXQUFBO0VBQ0EsZUFBQTtFQUNBLGtCQUFBO0FBQUY7O0FBR0E7RUFDRSxXQUFBO0VBQ0EsWUFBQTtFQUNBLGtDQUFBO0VBQ0EsbUJBQUE7RUFFQSxpQkFBQTtFQUNBLFdBQUE7RUFDQSx5QkFBQTtFQUNBLGdCQUFBO0FBREY7O0FBR0E7RUFDRSwwQkFBQTtBQUFGOztBQUdBO0VBQ0Usa0JBQUE7RUFDQSxVQUFBO0VBQ0EsU0FBQTtBQUFGOztBQUtBO0VBQ0UsYUFBQTtBQUZGIiwic291cmNlc0NvbnRlbnQiOlsiLmNvbnRhaW5lciB7XHJcbiAgaGVpZ2h0OiAxMDAlO1xyXG4gIGJhY2tncm91bmQtY29sb3I6ICMxODE4MWI7XHJcbiAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgIzJlMmUyZTtcclxufVxyXG5cclxuLypIRUFERVIqL1xyXG5cclxuLmhlYWRlciB7XHJcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMWYxZjIxO1xyXG4gIGJveC1zaGFkb3c6IDAgMnB4IDJweCByZ2JhKDAsMCwwLDAuMjUwOTgpXHJcbn1cclxuXHJcbi5zZWFyY2gtYm94IHtcclxuICB3aWR0aDogMTAwJTtcclxuICBwYWRkaW5nOiAxLjNyZW07XHJcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xyXG59XHJcblxyXG4uc2VhcmNoLWlucHV0IHtcclxuICB3aWR0aDogMTAwJTtcclxuICBib3JkZXI6IG5vbmU7XHJcbiAgcGFkZGluZzogMS4ycmVtIDEuNXJlbSAxLjJyZW0gNHJlbTtcclxuICBib3JkZXItcmFkaXVzOiAyMHB4O1xyXG5cclxuICBmb250LXNpemU6IDEuNnJlbTtcclxuICBjb2xvcjogI2ZmZjtcclxuICBiYWNrZ3JvdW5kLWNvbG9yOiAjMjcyNzJhO1xyXG4gIHRyYW5zaXRpb246IDAuMXM7XHJcbn1cclxuLnNlYXJjaC1pbnB1dDpmb2N1c3tcclxuICBvdXRsaW5lOiAycHggc29saWQgIzVmM2RjNDtcclxufVxyXG5cclxuLnNlYXJjaC1pY29uIHtcclxuICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgbGVmdDogMjNweDtcclxuICB0b3A6IDIycHg7XHJcbn1cclxuXHJcbi8vIE1BSU4gLy9cclxuXHJcbi5tYWluIHtcclxuICBwYWRkaW5nOiAxcmVtO1xyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["skip","Subject","takeUntil","tap","DialogsComponent","ngOnInit","subscribeToDialogs","dialogData","dialogs$","pipe","unsubscribe$","dialogs","subscribeToEachDialog","subscribe","forEach","dialog","dialogSubscription","counter","store","doc","ref","id","valueChanges","newDialog","createDialogUpdate","dialogEl","find","changeDialog","dialogToTop","splice","findIndex","el","unshift","oldDialog","updatedDialog","lastMessage","message","slice","messageLengthFix","lastMessageValue","content","lastMessageTime","time","constructor","dialogTrans","ngOnDestroy","next","complete","selectors","decls","vars","consts","template","i0","ctx"],"sourceRoot":"","sources":["C:\\Courses\\ANGULAR\\echo\\src\\app\\feature\\messenger\\messenger\\dialogs\\dialogs.component.ts","C:\\Courses\\ANGULAR\\echo\\src\\app\\feature\\messenger\\messenger\\dialogs\\dialogs.component.html"],"sourcesContent":["import {Component, OnDestroy, OnInit} from '@angular/core';\nimport {AngularFirestore, DocumentReference, DocumentSnapshot} from \"@angular/fire/compat/firestore\";\nimport {chat, message, UserDialog} from \"../../../user-data.service\";\nimport {DialogTransferService} from \"../../../dialog-transfer.service\";\nimport {filter, map, Observable, skip, Subject, Subscription, take, takeUntil, tap} from \"rxjs\";\nimport {DialogsDataService} from \"./dialogs-data.service\";\n\nexport interface newMessage {\n  ref: string,\n  mes: Observable<message | undefined>\n}\n\n@Component({\n  selector: 'app-dialogs',\n  templateUrl: './dialogs.component.html',\n  styleUrls: ['./dialogs.component.scss']\n})\n\nexport class DialogsComponent implements OnInit, OnDestroy {\n  public dialogs!: UserDialog[] | null;\n  counter: number = 0;\n\n  ngOnInit() {\n    this.subscribeToDialogs();\n  }\n\n // Функция для подписки на изменения списка диалогов\n  subscribeToDialogs() {\n    this.dialogData.dialogs$.pipe(\n      takeUntil(this.unsubscribe$),\n      tap(dialogs => this.dialogs = dialogs),\n      tap(dialogs => this.subscribeToEachDialog(dialogs as UserDialog[]))\n    ).subscribe();\n  }\n\n  // Функция для подписки на изменения каждого диалога\n  subscribeToEachDialog(dialogs: UserDialog[]) {\n    dialogs?.forEach(dialog => this.dialogSubscription(dialog));\n  }\n\n  // Подписываеться на изменения диалога\n  dialogSubscription(dialog: UserDialog) {\n    this.counter = 0;\n    return this.store.doc<chat>(`chats/${dialog.ref.id}`).valueChanges()\n      .pipe(\n        skip(1),\n        takeUntil(this.unsubscribe$),\n        tap(newDialog => this.createDialogUpdate(dialog, newDialog as chat))\n      ).subscribe();\n  }\n\n  // Функция для создания объекта с обновленными данными диалога\n  createDialogUpdate(dialog: UserDialog, newDialog:chat) {\n    let dialogEl = this.dialogs?.find(dialogEl => dialogEl === dialog)\n    dialogEl = this.changeDialog(dialogEl as UserDialog, newDialog)\n    this.dialogToTop(dialogEl)\n  }\n\n  // Вырезает диалог с массива диалогов и помещает на верх\n  dialogToTop(dialog: UserDialog): void {\n    this.dialogs?.splice(this.dialogs?.findIndex(el => el.ref.id === dialog.ref.id), 1);\n    this.dialogs?.unshift(dialog)\n  }\n\n  // Берёт последнее сообщение и изменяет диалог\n  changeDialog(oldDialog: UserDialog, updatedDialog: chat): UserDialog {\n    const lastMessage = updatedDialog.message.slice(-1)[0];\n    this.dialogData.messageLengthFix(lastMessage)\n    oldDialog.lastMessageValue = lastMessage?.content;\n    oldDialog.lastMessageTime = lastMessage?.time;\n    return oldDialog\n  }\n\n  constructor(\n    private store: AngularFirestore,\n    public dialogTrans:DialogTransferService,\n    private dialogData: DialogsDataService,\n  ) {\n  }\n\n  private unsubscribe$ = new Subject<void>();\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n}\n\n","<div class=\"container\">\n  <header class=\"header flex\">\n    <button mat-icon-button [matMenuTriggerFor]=\"menu\" color=\"accent\">\n      <mat-icon>more_vert</mat-icon>\n    </button>\n    <mat-menu #menu=\"matMenu\">\n      <button mat-menu-item>\n        <mat-icon>person</mat-icon>\n        <span>Your Profile</span>\n      </button>\n      <button mat-menu-item>\n        <mat-icon>edit</mat-icon>\n        <span>Start new chat</span>\n      </button>\n      <button mat-menu-item>\n        <mat-icon>contacts</mat-icon>\n        <span>Contacts</span>\n      </button>\n      <button mat-menu-item>\n        <mat-icon>notifications_off</mat-icon>\n        <span>Disable alerts</span>\n      </button>\n    </mat-menu>\n    <div class=\"search-box\">\n      <input type=\"text\" class=\"search-input\" placeholder=\"Search...\">\n      <mat-icon class=\"icon search-icon\">search</mat-icon>\n    </div>\n  </header>\n  <main class=\"main\">\n    <app-dialog (selectedDialog)=\"dialogTrans.dialog$.next($event)\" [dialogs]=\"dialogs\"></app-dialog>\n  </main>\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}