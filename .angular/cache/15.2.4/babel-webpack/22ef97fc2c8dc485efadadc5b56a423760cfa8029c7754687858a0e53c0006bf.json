{"ast":null,"code":"import { BehaviorSubject, Subject, takeUntil } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/compat/firestore\";\nexport class UserDataService {\n  constructor(store) {\n    this.store = store;\n    this.curUserData$ = new BehaviorSubject(null);\n    this.unsubscribe$ = new Subject();\n    this.getOtherUser = otherUserId => {\n      return otherUserId[0].id === this.curUserDoc.ref.id ? otherUserId[1] : otherUserId[0];\n    };\n    this.setNewUser(this.store.doc(`users/test--main`).ref);\n  }\n  // Func calls when Current User changes\n  setNewUser(user) {\n    this.unsubscribe$.next();\n    this.curUserDoc = this.store.doc(`users/${user.id}`);\n    this.curUserDoc.valueChanges().pipe(takeUntil(this.unsubscribe$)).subscribe(user => this.curUserData$.next(user));\n  }\n}\nUserDataService.ɵfac = function UserDataService_Factory(t) {\n  return new (t || UserDataService)(i0.ɵɵinject(i1.AngularFirestore));\n};\nUserDataService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: UserDataService,\n  factory: UserDataService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"AAIA,SAAQA,eAAe,EAAoBC,OAAO,EAAgBC,SAAS,QAAmB,MAAM;;;AAuCpG,OAAM,MAAOC,eAAe;EAK1BC,YAAoBC,KAAuB;IAAvB,UAAK,GAALA,KAAK;IAHlB,iBAAY,GAAG,IAAIL,eAAe,CAAgB,IAAI,CAAC;IACtD,iBAAY,GAAG,IAAIC,OAAO,EAAQ;IAcnC,iBAAY,GAAIK,WAA2D,IAAkD;MAClI,OAAOA,WAAW,CAAC,CAAC,CAAC,CAACC,EAAE,KAAK,IAAI,CAACC,UAAU,CAACC,GAAG,CAACF,EAAE,GAAGD,WAAW,CAAC,CAAC,CAAC,GAAGA,WAAW,CAAC,CAAC,CAAC;IACvF,CAAC;IAbC,IAAI,CAACI,UAAU,CAAC,IAAI,CAACL,KAAK,CAACM,GAAG,CAAS,kBAAkB,CAAC,CAACF,GAAG,CAAC;EACjE;EAEA;EACOC,UAAU,CAACE,IAA+B;IAC/C,IAAI,CAACC,YAAY,CAACC,IAAI,EAAE;IACxB,IAAI,CAACN,UAAU,GAAG,IAAI,CAACH,KAAK,CAACM,GAAG,CAAC,SAASC,IAAI,CAACL,EAAE,EAAE,CAAC;IACpD,IAAI,CAACC,UAAU,CAACO,YAAY,EAAE,CAACC,IAAI,CAACd,SAAS,CAAC,IAAI,CAACW,YAAY,CAAC,CAAC,CAACI,SAAS,CACvEL,IAAI,IAAI,IAAI,CAACM,YAAY,CAACJ,IAAI,CAACF,IAAc,CAAC,CACjD;EACH;;AAhBWT,eAAe;mBAAfA,eAAe;AAAA;AAAfA,eAAe;SAAfA,eAAe;EAAAgB,SAAfhB,eAAe;EAAAiB,YAHd;AAAM","names":["BehaviorSubject","Subject","takeUntil","UserDataService","constructor","store","otherUserId","id","curUserDoc","ref","setNewUser","doc","user","unsubscribe$","next","valueChanges","pipe","subscribe","curUserData$","factory","providedIn"],"sourceRoot":"","sources":["C:\\Courses\\ANGULAR\\echo\\src\\app\\feature\\user-data.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport firebase from \"firebase/compat\";\nimport DocumentReference = firebase.firestore.DocumentReference;\nimport {AngularFirestore, AngularFirestoreDocument, DocumentSnapshot} from \"@angular/fire/compat/firestore\";\nimport {BehaviorSubject, from, Observable, Subject, Subscription, takeUntil, throwError} from \"rxjs\";\n\n// Interfaces to export to components //\nexport interface UserDialog {\n  ref: DocumentReference<chat>,\n  otherUserName: string,\n  otherUserPhoto: string,\n  lastMessageTime: string | undefined,\n  lastMessageValue: string | undefined,\n}\n\nexport interface User {\n  name: string,\n  photo: string,\n  dialogs?: DocumentReference<message>[]\n}\n\n// Interfaces from DataBase //\nexport interface UserDB {\n  name: string,\n  photo: string,\n  dialogs: DocumentReference<chat>[]\n}\n\nexport interface chat {\n  message: message[],\n  users: DocumentReference<UserDB>[]\n}\n\nexport interface message {\n  time: string,\n  content: string,\n  senderId: DocumentReference\n}\n\n@Injectable({\n  providedIn: 'root'\n})\n\nexport class UserDataService {\n  public curUserDoc!: AngularFirestoreDocument<UserDB>;\n  public curUserData$ = new BehaviorSubject<UserDB | null>(null);\n  private unsubscribe$ = new Subject<void>();\n\n  constructor(private store: AngularFirestore) {\n    this.setNewUser(this.store.doc<UserDB>(`users/test--main`).ref)\n  }\n\n  // Func calls when Current User changes\n  public setNewUser(user: DocumentReference<UserDB>): void {\n    this.unsubscribe$.next();\n    this.curUserDoc = this.store.doc(`users/${user.id}`);\n    this.curUserDoc.valueChanges().pipe(takeUntil(this.unsubscribe$)).subscribe(\n        user => this.curUserData$.next(user as UserDB)\n    );\n  }\n  public getOtherUser = (otherUserId: firebase.firestore.DocumentReference<UserDB>[]): firebase.firestore.DocumentReference<UserDB> => {\n    return otherUserId[0].id === this.curUserDoc.ref.id ? otherUserId[1] : otherUserId[0]\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}